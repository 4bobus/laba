# laba

## МОДУЛЬ 1

 Задание: 
 Необходимо разработать и настроить инфраструктуру информационно коммуникационной системы согласно предложенной топологии (см. Рисунок 1). Задание включает базовую настройку устройств: 
- присвоение имен устройствам, 
- расчет IP-адресации, 
- настройку коммутации и маршрутизации.

 В ходе проектирования и настройки сетевой инфраструктуры следует вести отчет о своих действиях, включая таблицы и схемы, предусмотренные в задании. Итоговый отчет должен содержать одну таблицу и пять отчетов о ходе работы. Итоговый отчет по окончании работы следует сохранить на диске рабочего места

<p align="center">
  <img src="images/module1/2. топология сети.png" width="600" />
</p>

<p align="center">
  <img src="images/module1/1. Таблица IP-адресов.png" width="600" />
</p>

<p align="center"><b>Чтобы зайти на стенд для 1 модуля.</b></p>
 
<p align="center"><b>User name: m1</b></p>  
<p align="center"><b>Password: modul1</b></p>

Перед включением виртуалок Настроем вланы. По заданию HQ-SRV в 100 влане, а  HQ-CLI в 200
> **Примечание:**
> Основные сведения о настройке коммутатора и выбора реализации разделения на VLAN занесите в отчёт

![](<images/module1/4. vlan.png>)

![](<images/module1/5. vlan.png>)

![](<images/module1/6. vlan.png>)

![](<images/module1/7. vlan.png>)

**ISP преднастроена, но включать ее надо**

![](<images/module1/8. таблица адресации.png>)


### <p align="center"><b>Сетевая связность - между HQ и BRANCH</b></p>
> **Примечание:**
> Сведения об адресах занесите в отчёт, в качестве примера используйте Таблицу 3

 *HQ-RTR*

Задаём сразу FQDN - выбор имени домена произвольный:

![](<images/module1/9. сетевая связность.png>)

По такой же аналогии настройте остальные имена

Чтобы настроить адресацию переходим:

![](<images/module1/10..png>)

Заодно настроим GRE туннель

![](<images/module1/11..png>)

![](<images/module1/12..png>)

Включаем пересылку пакетов между портами (интерфейсами)

![](<images/module1/13..png>)

![](<images/module1/14..png>)

Применяем: 

***sysctl -p***

Прокинем PAT так, как по приколу тачки, что подключены к роутеру пинговать инет не будут.

![](<images/module1/15..png>)

![](<images/module1/16. nftables.png>)

Обязательно добавим в автозагрузку и активируем

![](<images/module1/17..png>)

Туннель мы допустим подняли, но чтобы пакеты через него пошли, нужна маршрутизация.
> **Примечание:**
> Сведения о настройке и защите протокола(ospf) занесите в отчёт

Установим frr.

![](<images/module1/18..png>)
> **РЕКОМЕНДАЦИЯ:**
> ПОКА FRR СКАЧИВАЕТСЯ ПЕРЕХОДИМ К НАСТРОЙКЕ BR-RTR

В файле /etc/frr/daemons - включим поддержку OSPFv2 (IPv4)

![](<images/module1/19..png>)

Не забываем перезапускать, чтобы изменения вступили в силу

![](<images/module1/20..png>)

Переходим к настройке frr (ospf)

![](<images/module1/21..png>)

Поставим пароль на frr

![](<images/module1/22..png>)

Не забываем перезапустить

![](<images/module1/23..png>)

И добавить в автозагрузку

![](<images/module1/24..png>)


 *BR-RTR*

Произведем те же манипуляции

![](<images/module1/25..png>)

![](<images/module1/26..png>)

![](<images/module1/27..png>)

![](<images/module1/28..png>)

![](<images/module1/29..png>)

![](<images/module1/30..png>)

![](<images/module1/31..png>)

![](<images/module1/32..png>)

![](<images/module1/33..png>)

> **РЕКОМЕНДАЦИЯ:**
> ПОКА FRR СКАЧИВАЕТСЯ ДОДЕЛЫВАЕМ FRR НА HQ-RTR

![](<images/module1/34..png>)

![](<images/module1/35..png>)

![](<images/module1/36..png>)

![](<images/module1/37..png>)

![](<images/module1/38..png>)

![](<images/module1/39..png>)

Ура сетевая связность у между hq и br настроена

Для проверки пингуем с br-rtr:  
***ping 192.168.100.1***

> **РЕКОМЕНДАЦИЯ:**
> сразу на HQ-RTR скачаем: apt update && apt install –y isc-dhcp-server


 *HQ-SRV*

Задаем имя:  
> **ВНИМАНИЕ:**
> Нужно обновить изображение

![](<images/module1/43..png>)

Прокинем инет:

![](<images/module1/40. hq-srv.png>)

Перезапускаем сервис:  
***Systemctl restart networking***

Проверяем:

![](<images/module1/41..png>)


 *BR-SRV*

![](<images/module1/43..png>)

![](<images/module1/42. br-srv.png>)

Перезапускаем сервис:  
***Systemctl restart networking***

Проверяем:

![](<images/module1/41..png>)

> **РЕКОМЕНДАЦИЯ:**
> сразу скачиваем на HQ-SRV: apt update && apt install -y dnsmasq


  ### Создание локальных учетных записей


- Создайте пользователя sshuser на серверах

 *HQ-SRV и BR-SRV*

![](<images/module1/44. sshuser.png>)

Пользователь sshuser должен иметь возможность запускать sudo без дополнительной аутентификации.

В дебиане нету судо поэтому скачаем:

![](<images/module1/45..png>)

![](<images/module1/46..png>)

НА BR-SRV СДЕЛАЙТЕ ТОЖЕ САМОЕ


- Создайте пользователя net_admin на маршрутизаторах

 *HQ-RTR и BR-RTR*

![](<images/module1/47. net_admin.png>)

![](<images/module1/48..png>)

В дебиане нет sudo поэтому скачаем

![](<images/module1/49..png>)

![](<images/module1/50..png>)

СДЕЛАЙТЕ ТОЖЕ САМОЕ НА BR-RTR


  ### Настройка безопасного удаленного доступа на серверах HQ-SRV и BR-SRV: 

- Для подключения используйте порт 2024 
- Разрешите подключения только пользователю sshuser ● Ограничьте количество попыток входа до двух 
- Настройте баннер «Authorized access only»

 *HQ-SRV и BR-SRV*

![](<images/module1/51. ssh.png>)

Редактируем файл /etc/ssh/sshd_config:

![](<images/module1/52..png>)

![](<images/module1/53..png>)

![](<images/module1/54..png>)

![](<images/module1/55..png>)

ДУБЛИРУЕМ ТОЖЕ САМОЕ НА BR-SRV


  ### Установим и настроим DHCP-сервер 

и зарезервируем адрес для HQ-SRV, чтобы потом на всех остальных оконечных устройствах задавая адреса сразу создавать пользователей

 *HQ-RTR:*

Скачаем: apt install –y isc-dhcp-server

Первым делом нам необходимо указать, что наш DHCP сервер должен принимать запросы только с ens20 интерфейса.

![](<images/module1/56. dhcp.png>)

![](<images/module1/57. dhcp.png>)

Настройка протокола динамической конфигурации хостов. 

- Настройте нужную подсеть 
- Для офиса HQ в качестве сервера DHCP выступает маршрутизатор HQ-RTR. 
- Клиентом является машина HQ-CLI. 
- Исключите из выдачи адрес маршрутизатора 
- Адрес шлюза по умолчанию – адрес маршрутизатора HQ-RTR. 
- Адрес DNS-сервера для машины HQ-CLI – адрес сервера HQ-SRV. 
- DNS-суффикс для офисов HQ – au-team.irpo 
- Сведения о настройке протокола занесите в отчёт

![](<images/module1/58. dhcp.png>)

![](<images/module1/59. dhcp.png>)

![](<images/module1/60. dhcp.png>)

> **Примечание:**
> Сведения о настройке протокола занесите в отчёт


  ### Настройка DNS для офисов HQ и BR. 

- Основной DNS-сервер реализован на HQ-SRV. 
- Сервер должен обеспечивать разрешение имён в сетевые адреса устройств и обратно в соответствии с таблицей 2 
- В качестве DNS сервера пересылки используйте любой общедоступный DNS сервер

Нам необходимо настроить DNS сервер. Будем использовать dnsmasq.

 *HQ-SRV*

![](<images/module1/61. dns.png>)

![](<images/module1/62. dns.png>)

![](<images/module1/63. dns.png>)

Теперь открываем скрипт-инициализации сервиса dnsmasq

![](<images/module1/64. dns.png>)

ищем строчку DNSMASQ_OPTS

![](<images/module1/65. dns.png>)

Убираем оттуда –local-service

![](<images/module1/66. dns.png>)

Перезагружаем службу dnsmasq:  
***systemctl restart dnsmasq***

После настройки dns-сервера прописываем всем машинам в /etc/resolv.conf:  
***ameserver 192.168.100.2***

![](<images/module1/67. таблица доменных имен.png>)


  ### Настройте часовой пояс на всех устройствах, согласно месту проведения экзамена.

 *HQ-SRV, HQ-CLI, BR-SRV*

Проверяем какой часовой пояс установлен:  
***timedatectl status***

![](<images/module1/68. часовой пояс.png>)

Если отличается, то устанавливаем:  
***timedatectl set-timezone Asia/Yekaterinburg***



## МОДУЛЬ 2 

Чтобы зайти на стенд для 1 модуля. 
 
User name: m2  
Password: modul2
 
 **(СДЕЛАТЬ SNAPSHOT BR-SRV)**

Настройте доменный контроллер Samba на машине BR-SRV.

- Создайте 5 пользователей для офиса HQ: имена пользователей формата user№.hq. Создайте группу hq, введите в эту группу созданных пользователей 
- Введите в домен машину HQ-CLI 
- Пользователи группы hq имеют право аутентифицироваться на клиентском ПК 
- Пользователи группы hq должны иметь возможность повышать привилегии для выполнения ограниченного набора команд: cat, grep, id. Запускать другие команды с повышенными привилегиями пользователи группы не имеют права 
- Выполните импорт пользователей из файла users.csv. Файл будет располагаться на виртуальной машине BR-SRV в папке /opt

 *BR-SRV*

> **Обязательно:**
> Временно заменяем в /etc/resolv.conf 192.168.100.2 на  10.0.1.4, чтобы samba быстрее скачивалось

Переходим к настройкам самого контроллера домена на BR-SRV
